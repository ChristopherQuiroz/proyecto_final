{% extends "layout_cliente.html" %}

{% block cliente_extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/cliente/detalle_producto.css') }}">
{% endblock %}

{% block cliente_content %}

<div class="producto-detalle-container">

    <!-- ================= IMAGEN ================= -->
    <div class="detalle-imagen">
        {% set img_url = url_for('static', filename='img/products/' ~ producto.imagen) %}
        {% set default_img = url_for('static', filename='img/products/cupcake.jpg') %}
        <img src="{{ img_url }}" onerror="this.src='{{ default_img }}'">
    </div>

    <!-- ================= INFORMACIÓN ================= -->
    <div class="detalle-info">

        <h1 class="titulo">{{ producto.nombre }}</h1>

        <p class="precio">{{ producto.precio }} Bs</p>

        <!-- ================= DETALLES CON "VER MÁS" ================= -->
        <div class="cantidad-box">Detalles:</div>

        <div class="descripcion-corta" id="descripcionCorta">
            {{ producto.descripcion[:180] }}{% if producto.descripcion|length > 180 %}...{% endif %}
        </div>

        {% if producto.descripcion|length > 180 %}
        <button class="ver-mas" onclick="toggleDescripcion()">Ver más</button>
        {% endif %}

        <div class="descripcion-completa" id="descripcionCompleta">
            {{ producto.descripcion }}
        </div>

        <!-- ================= CANTIDAD Y BOTÓN ================= -->
        <div class="cantidad-box">Cantidad</div>

        <div class="cantidad-control">
            <button type="button" onclick="restar()">−</button>
            <input type="number" id="cantidad" name="cantidad" min="1" value="1" readonly>
            <button type="button" onclick="sumar()">+</button>
        </div>

        <form action="/cliente/carrito/agregar/{{ producto.id }}" method="POST">
            <input type="hidden" id="cantidad_enviar" name="cantidad" value="1">
            <button type="submit" class="btn-agregar">AÑADIR A LA CESTA</button>
        </form>

    </div>
</div>


<!-- ================= SCRIPT ================= -->
<script>
function sumar() {
    let c = document.getElementById("cantidad");
    c.value = parseInt(c.value) + 1;
    document.getElementById("cantidad_enviar").value = c.value;
}

function restar() {
    let c = document.getElementById("cantidad");
    if (parseInt(c.value) > 1) {
        c.value = parseInt(c.value) - 1;
        document.getElementById("cantidad_enviar").value = c.value;
    }
}

function toggleDescripcion() {
    const corta = document.getElementById("descripcionCorta");
    const completa = document.getElementById("descripcionCompleta");
    const btn = document.querySelector(".ver-mas");

    if (completa.style.display === "block") {
        completa.style.display = "none";
        corta.style.display = "block";
        btn.textContent = "Ver más";
    } else {
        completa.style.display = "block";
        corta.style.display = "none";
        btn.textContent = "Ver menos";
    }
}
</script>


<!-- ================= PRODUCTOS RELACIONADOS ================= -->
{% if relacionados %}
<div class="relacionados-seccion">
    <h2>Productos relacionados</h2>

    <div class="relacionados-grid">

        {% for rel in relacionados %}
        <div class="rel-card">
            <img src="{{ url_for('static', filename='img/products/' ~ rel.imagen) }}"
                 onerror="this.src='{{ url_for('static', filename='img/products/cupcake.jpg') }}'">

            <h3>{{ rel.nombre }}</h3>
            <p>{{ rel.precio }} Bs</p>
            <a href="/cliente/producto/{{ rel.id }}" class="btn-rel">Ver producto</a>
        </div>
        {% endfor %}

    </div>
</div>
{% endif %}


<!-- ================= INFORMACIÓN DEL PRODUCTO (ALIMENTOS) ================= -->
<div class="info-alimento">
    <h2>Información del producto</h2>
    <ul>
        <li>Producto elaborado bajo estrictas normas de higiene.</li>
        <li>Ideal para celebraciones, eventos y consumo inmediato.</li>
        <li>Ingredientes de alta calidad para garantizar un sabor excepcional.</li>
        <li>Conservar en refrigeración si no se consume en el momento.</li>
        <li>Evitar exposición directa al sol o calor excesivo.</li>
    </ul>
</div>


<!-- ================= RECOMENDACIONES DE CONSUMO ================= -->
<div class="recomendaciones-alimento">
    <h2>Recomendaciones de consumo</h2>
    <ul>
        <li>Consumir preferiblemente antes de 48 horas.</li>
        <li>Servir a temperatura ambiente para mejor sabor.</li>
        <li>No congelar para evitar cambios en textura y sabor.</li>
        <li>Mantener refrigerado cuando no esté en uso.</li>
    </ul>
</div>

{% endblock %}

{% extends "layout_cliente.html" %}

{% block cliente_extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/cliente/productos.css') }}">
{% endblock %}

{% block cliente_content %}

<h1 class="titulo-pagina">Productos</h1>

<!-- ðŸ”Ž BUSCADOR + FILTROS + ORDENAR + VISTAS -->
<div class="barra-superior">

    <!-- FILTRAR -->
    <button class="btn-filtrar">
        <span>â›ƒ</span> Filtrar
    </button>

    <!-- VISTAS -->
    <div class="vista-opciones">
        <button class="vista-btn" data-cols="1">â–¤</button>
        <button class="vista-btn" data-cols="2">â–¥</button>
        <button class="vista-btn" data-cols="3" id="vista-activa">â–¦</button>
        <button class="vista-btn" data-cols="4">â–§</button>
    </div>

    <!-- ORDENAR -->
    <select id="ordenar" class="ordenar-select">
        <option value="presentado">Presentado</option>
        <option value="az">AlfabÃ©ticamente Aâ€“Z</option>
        <option value="za">AlfabÃ©ticamente Zâ€“A</option>
        <option value="precio-menor">Precio: menor a mayor</option>
        <option value="precio-mayor">Precio: mayor a menor</option>
    </select>

    <!-- BUSCAR -->
    <input type="text" id="buscar" placeholder="Buscar..." class="input-buscar">

</div>

<!-- ====================== GRID ======================= -->

<div id="productos-grid" class="grid-3">

    {% for p in productos %}
    <div class="producto-card"
         data-nombre="{{ p.nombre }}"
         data-descripcion="{{ p.descripcion }}"
         data-categoria="{{ p.categoria }}"
         data-precio="{{ p.precio }}"
         data-stock="{{ p.cantidad }}">

        <!-- IMAGEN -->
        <div class="card-img-container">
            <img src="{{ url_for('static', filename='img/products/' ~ p.imagen) }}"
                 onerror="this.src='{{ url_for('static', filename='img/products/cupcake.jpg') }}'">
        </div>

        <!-- INFO -->
        <div class="card-info">
            <h3>{{ p.nombre }}</h3>
            <p class="precio">Bs {{ p.precio }}</p>
        </div>

        <!-- BOTÃ“N DETALLE (Ã­cono carrito pero abre detalle) -->
        <a href="/cliente/producto/{{ p.id }}" class="btn-carrito">
            ðŸ›’
        </a>

    </div>
    {% endfor %}

</div>

<script>
/* FILTROS Y ORDENAMIENTO */
function aplicarFiltros() {
    let buscar = document.getElementById("buscar").value.toLowerCase();
    let ordenar = document.getElementById("ordenar").value;

    let cards = Array.from(document.querySelectorAll(".producto-card"));

    /* FILTRO DE TEXTO */
    cards.forEach(card => {
        let nombre = card.dataset.nombre.toLowerCase();
        let desc = card.dataset.descripcion.toLowerCase();

        card.style.display =
            (nombre.includes(buscar) || desc.includes(buscar))
            ? "block"
            : "none";
    });

    /* ORDENAMIENTO */
    cards.sort((a, b) => {
        let n1 = a.dataset.nombre.toLowerCase();
        let n2 = b.dataset.nombre.toLowerCase();
        let p1 = parseFloat(a.dataset.precio);
        let p2 = parseFloat(b.dataset.precio);

        switch (ordenar) {
            case "az": return n1.localeCompare(n2);
            case "za": return n2.localeCompare(n1);
            case "precio-menor": return p1 - p2;
            case "precio-mayor": return p2 - p1;
            default: return 0;
        }
    });

    /* REORDENAR EN HTML */
    let grid = document.getElementById("productos-grid");
    grid.innerHTML = "";
    cards.forEach(c => grid.appendChild(c));
}

document.getElementById("buscar").addEventListener("input", aplicarFiltros);
document.getElementById("ordenar").addEventListener("change", aplicarFiltros);


/* CAMBIO DE COLUMNAS */
document.querySelectorAll(".vista-btn").forEach(btn => {
    btn.addEventListener("click", () => {
        let columnas = btn.dataset.cols;
        let grid = document.getElementById("productos-grid");

        grid.className = "grid-" + columnas;

        /* Marcar vista activa */
        document.querySelectorAll(".vista-btn").forEach(b => b.removeAttribute("id"));
        btn.id = "vista-activa";
    });
});
</script>

{% endblock %}
